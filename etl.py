# -*- coding: utf-8 -*-
"""ETL

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1UAwr81XWUDyF7-Vex_EAq1tiFOwnaK-s
"""

import pandas as pd
import numpy as np
import requests
from io import StringIO
import subprocess
import tarfile

# Detectar si se está en Google Colab
try:
    from google.colab import files
    colab = True
except ImportError:
    colab = False

def celsius_to_fahrenheit(celsius):
    """Convierte temperatura de Celsius a Fahrenheit"""
    return (celsius * 9/5) + 32

def transform_data(url):
    print(" Descargando datos desde la URL...")
    try:
        df = pd.read_csv(url, encoding='utf-8', delimiter=';')
    except Exception as e:
        print(f" Error al leer el archivo: {e}")
        return None

    print(" Datos descargados correctamente.")
    print("\n Vista previa de los datos originales:")
    print(df.head())

    # Transformación
    print("\n Transformando datos...")
    columns_to_convert = ['T.Maxima', 'T.Minima']

    for col in columns_to_convert:
        if col in df.columns:
            try:
                df[col] = pd.to_numeric(df[col], errors='coerce')
                df[f"{col}_Fahrenheit"] = df[col].apply(celsius_to_fahrenheit)
                print(f" Convertida {col} a {col}_Fahrenheit")
            except Exception as e:
                print(f" Error al convertir {col}: {e}")
        else:
            print(f" Columna {col} no encontrada")

    output_file = "temperaturas_transformadas.csv"
    df.to_csv(output_file, index=False, sep=',', encoding='utf-8')
    return output_file
